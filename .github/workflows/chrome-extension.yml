name: Deploy Chrome Extension to Web Store

on:
  push:
    branches:
      - main  # Ajuste para a branch desejada

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
    # ğŸ›ï¸ Checkout do repositÃ³rio
    - name: Checkout repository
      uses: actions/checkout@v4

    # ğŸ› ï¸ Instalar dependÃªncias (caso necessÃ¡rio)
    - name: Install Dependencies
      run: |
        npm install

    # ğŸ“¦ Gerar o arquivo ZIP da extensÃ£o
    - name: Build Extension
      run: |
        cd chrome-cupom-extension
        zip -r ../extension.zip .

    # ğŸš€ Fazer upload para a Chrome Web Store
    - name: Upload to Chrome Web Store
      uses: trmcnvn/chrome-webstore-upload@v2
      with:
        client_id: ${{ secrets.CLIENT_ID }}
        client_secret: ${{ secrets.CLIENT_SECRET }}
        refresh_token: ${{ secrets.REFRESH_TOKEN }}
        extension_id: ${{ secrets.EXTENSION_ID }}
        file: extension.zip

    # ğŸ“¢ Publicar automaticamente
    - name: Publish Extension
      uses: trmcnvn/chrome-webstore-upload@v2
      with:
        client_id: ${{ secrets.CLIENT_ID }}
        client_secret: ${{ secrets.CLIENT_SECRET }}
        refresh_token: ${{ secrets.REFRESH_TOKEN }}
        extension_id: ${{ secrets.EXTENSION_ID }}
        publish: true

    # âœ… Finalizar com sucesso
    - name: Success
      run: echo "ExtensÃ£o publicada com sucesso na Chrome Web Store!"
